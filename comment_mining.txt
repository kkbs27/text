import pandas as pd
from konlpy.tag import Okt
from collections import Counter

# 데이터 로드
path = "경로"
df_original = pd.read_csv(path, encoding = "cp949")

# 분석 준비
df = df_original.copy()
okt = Okt()

# 명사 추출
df['nouns'] = df['text'].apply(lambda x: okt.nouns(x))

# Counter가 셀 수 있도록 한 리스트 안에 담아주기
all_nouns = [] 

for nouns_list in df['nouns']:
    all_nouns.extend(nouns_list)


### 상위 5개 단어 출력 ###
result = Counter(all_nouns)
top_5 = result.most_common(5)


### 동시출현 단어 ###
co_word = []

for target_word, target_freq in top_5:
    
    co_words = []
    
    # df의 각 행 돌면서 확인
    for nouns_list in df['nouns']:
        # 타겟 단어가 포함되어 있다면
        if target_word in nouns_list:
            # 함께 있는 다른 단어들을 수집
            for noun in nouns_list:
                if noun != target_word:  # 자기 자신 제외
                    co_words.append(noun)
    
    # 함께 나온 단어 중 빈도 높은 3개 추출
    top_3_co = Counter(co_words).most_common(3)
    
    # 결과 데이터 저장
    for co_word, co_freq in top_3_co:
        ratio = co_freq / target_freq  # 전체 등장 횟수 대비 동시 출현 비율
        
        co_words.append({
            '핵심단어': target_word,
            '동시출현단어': co_word,
            '동시출현빈도': co_freq,
            '비율': f"{ratio * 100:.1f}%"
        })

df_final = pd.DataFrame(co_words)

print(result_df)

